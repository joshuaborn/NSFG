---
title: "Use and Nonuse of Contraception in the United States Reported in the 2017-2019 National Survey of Family Growth"
author: "Joshua Born"
output:
  bookdown::html_document2:
    code_folding: hide
    toc: true
    toc_depth: 5
  number_sections: TRUE
  fig_caption: TRUE
bibliography: "bibliographies/use-and-nonuse-of-contraception-in-the-united-states-2017-2019.bib"
csl: "bibliographies/chicago-author-date.csl"
link-citations: true
---

```{r setup, include=FALSE}
library(data.table)
library(ggplot2)
library(here)
library(huxtable)

i_am('reports/use-and-nonuse-of-contraception-in-the-united-states-2017-2019.Rmd')

source(here('R/NSFG_helpers.R'))
source(here('R/general_helpers.R'))
source(here('R/general_plots.R'))

knitr::opts_chunk$set(
  cache = TRUE,
  echo = FALSE,
  fig.align = 'center',
  fig.height = 8,
  fig.width = 12,
  message = FALSE,
  warning = FALSE
)
```

```{r load-data}
set_NSFG_2017_2019_data()
```

```{r process-fem-data, dependson='load-data'}
fem1719formats <- rbindlist(list(
  fem1719$Formats,
  # Include missing level 13 for WHYNOTPGF format.
  data.table(
    format_name = 'WHYNOTPGF',
    factor_value = 13,
    factor_label = 'No menstrual cycle or menstrual irregularity'
  ),
  # Create custom format encoding for ever_used_method series from METHHXF and OTHRMETHF.
  fem1719$Formats[
    (
      format_name == 'METHHXF' &
        factor_value %in% c(3:18, 20:21, 25:26, 98:99)
    ) | (
      format_name == 'OTHRMETHF' &
        factor_value == 24
    ),
    .(
      format_name = 'ever_used_method',
      factor_value,
      factor_label
    )
  ],
  data.table(
    format_name = 'ever_used_method',
    factor_value = c(31:33),
    factor_label = c(
      'Copper-bearing IUD (such as Copper-T or ParaGard)',
      'Hormonal IUD (such as Mirena, Skyla, Liletta, or Kyleena)',
      'Other or unknown IUD'
    )
  )
))
setkey(fem1719formats, format_name, factor_value)


## Make IF VOLUNTEERED: text in factor labels not all caps.
fem1719formats[,
  factor_label := gsub(
    "(.?If volunteered:.?\\s?)(.*)",
    'If volunteered: \\2',
    factor_label,
    ignore.case = TRUE
  )
]


## Start working female respondents data table.
fem1719dt <- copy(fem1719$Data[, .(
  AGE_R,
  CASEID,
  SECU,
  SEST,
  WGT2017_2019
)])


## Copy variables to working data table and set them to factors.
set_NSFG_variables_as_factors(
  variables = c(
    ATTRACT = 'ATTRACT',
    CONDVAG = 'YESNONAF',
    CONSTAT1 = 'CONSTATF',
    CURRMETH1 = 'METHHXF',
    CURRPREG = 'Y1N5C',
    EVERUSED = 'YESNONAF',
    HADSEX = 'HADSEX',
    HPPREGQ = 'HPPREGQ',
    LSEXPREG = 'Y1N2RECF',
    MISSPILL = 'MISSPILL',
    P12MOCON = 'P12MOCON',
    P1YRELP = 'P1YRELP',
    POSIBLMN = 'Y1N5RDF',
    POSIBLPG = 'Y1N5RDF',
    PSURGSTR = 'Y1N5C',
    PXNOFREQ = 'P12METHF',
    REASIMPP = 'REASP',
    REASIMPR = 'REASR',
    RSTRSTAT = 'RSTRSTAT',
    SEX3MO = 'Y1N2RECF',
    TUBS = 'Y1N5C',
    VAGSEX = 'YESNONAF',
    WHYCONDL = 'WHYCONDL',
    WHYNOUSING1 = 'WHYNOUSNG',
    WYNOLSTP = 'Y1N5RDF',
    WYNOTUSE = 'Y1N5RDF',
    YNOSEX = 'YNOSEX'
  )
)


## Create categorical variable for whether had intercourse with opposite sex in previous 3 months.
fem1719dt[,
  sexually_active_3m := factor(fifelse(
    SEX3MO == 'YES',
    'Had intercourse',
    'Did not have intercourse'
  ))
]


## Create boolean variables for whether each contraceptive method was used during last intercourse within the past 3 months.
set_NSFG_mentions_to_booleans(
  out_prefix = 'used_last_3m_method',
  in_prefix = 'METH3M',
  in_series = 1:3,
  format = 'METH3MF',
  skip = 20:21
)


## If last intercourse within the past 3 months was with husband or cohabitating partner who has an active vasectomy, then set boolean variable of vasectomy use during last intercourse within the past 3 months to true.
fem1719dt[,
  used_last_3m_method3 := fifelse(
    SEX3MO == 'YES' & PSURGSTR == 'YES' & (
      P1YRELP == 'Current husband or (current husband from whom she is separated)' |
      P1YRELP == 'Current cohabiting partner'
    ),
    TRUE,
    used_last_3m_method3
  )
]


## If respondent has had intercourse in the past 3 months and has an active tubal ligation (or essure), then set boolean variable of tubal ligation use during last intercourse within the past 3 months to true.
fem1719dt[,
  used_last_3m_method4 := fifelse(
    SEX3MO == 'YES' & TUBS == 'YES',
    TRUE,
    used_last_3m_method4
  )
]


## Reset count of methods used during last intercourse within the past 3 months to include overrides of vasectomy and tubal ligation boolean variables.
set_count_variable_for_mentions(fem1719dt, 'used_last_3m_method')


## Create categorical variable specifying reasons not at increased risk for unintended pregnancy, if applicable.
fem1719dt[,
  used_last_3m_status := factor(
    fcase(
      used_last_3m_method_count > 0,
        'Used at least one contraceptive method during last intercourse',
      SEX3MO != 'YES',
        'Did not have sexual intercourse with male in past 3 months',
      LSEXPREG == 'YES',
        'Pregnant in month of last intercourse',
      CONSTAT1 == 'Postpartum',
        'Postpartum',
      (WYNOTUSE == 'Yes' | WYNOLSTP == 'Yes'),
        'Currently trying to conceive',
      POSIBLPG == 'No',
        'Physically infertile not due to sterilizing procedure',
      POSIBLMN == 'No' & (
        P1YRELP == 'Current cohabiting partner' |
        P1YRELP == 'Current husband or (current husband from whom she is separated)'
      ),
        'Last intercourse was with partner who is physically infertile not due to sterilizing procedure',
      default = 'Otherwise did not use contraception during last intercourse'
    ),
    ordered = TRUE,
    levels = c(
      'Used at least one contraceptive method during last intercourse',
      'Did not have sexual intercourse with male in past 3 months',
      'Pregnant in month of last intercourse',
      'Postpartum',
      'Currently trying to conceive',
      'Physically infertile not due to sterilizing procedure',
      'Last intercourse was with partner who is physically infertile not due to sterilizing procedure',
      'Otherwise did not use contraception during last intercourse'
    )
  )
]


## Create categorical variable specifying whether respondent or partner wants to conceive.
fem1719dt[,
  pregnancy_intent_status := factor(
    fcase(
      WYNOTUSE == 'No answer provided',
        'No answer provided',
      WYNOTUSE == 'Yes',
        'Wants to get pregnant',
      HPPREGQ == 'Yes',
        'Partner wants respondent to get pregnant',
      WYNOTUSE == "Don't know" | HPPREGQ == "Don't know",
        "Don't know",
      WYNOTUSE == 'Refused' | HPPREGQ == 'Refused',
        'Refused',
      HPPREGQ == 'If volunteered: no current partner',
        'If volunteered: No current partner',
      HPPREGQ == 'No answer provided',
        'No answer provided',
      default = 'Not intending to conceive'
    ),
    ordered = TRUE,
    levels = c(
      'Wants to get pregnant',
      'Partner wants respondent to get pregnant',
      "Don't know",
      'Refused',
      'If volunteered: No current partner',
      'Not intending to conceive',
      'No answer provided'
    )
  )
]


## Create boolean variables for whether each reason for not using contraception was mentioned.
set_NSFG_mentions_to_booleans(
  out_prefix = 'nonuse_reason',
  in_prefix = 'WHYNOUSING',
  in_series = 1:5,
  format = 'WHYNOUSNG'
)


## Create boolean variables for whether each reason for not being able to get pregnant was mentioned.
set_NSFG_mentions_to_booleans(
  out_prefix = 'pregnancy_impossible_reason',
  in_prefix = 'WHYNOTPG',
  in_series = 1:2,
  format = 'WHYNOTPGF'
)


## Create boolean variables for whether each method was used at all in the past 3 months.
fem1719METHXidxs <- get_NSFG_format_indices('METHHXF', skip = c(1:2, 22:23, 55, 98:99))
names(fem1719METHXidxs) <- paste0('any_use_12m_method', fem1719METHXidxs)
fem1719METHX <- create_NSFG_pivot_table('METHX', 1:192)
fem1719METHX[, CMMHCALXID := ceiling(METHXID / 4)]
fem1719METHX <- fem1719METHX[
  create_NSFG_pivot_table(
    'CMMHCALX',
    1:48,
    c('CASEID', 'CMINTVW', 'CMLSTYR', 'LSEXDATE')
  ),
  on = c('CASEID', 'CMMHCALXID')
]
fem1719dt <- fem1719METHX[
  !is.na(METHX) & !is.na(CMMHCALX) &
    CMMHCALX > CMLSTYR &
    CMMHCALX <= CMINTVW,
  lapply(
    fem1719METHXidxs,
    \(x) any(.SD$METHX == x)
  ),
  by = CASEID
][fem1719dt]
fem1719dt[,
  names(fem1719METHXidxs) := lapply(.SD, na_to_false),
  .SDcols = names(fem1719METHXidxs)
]


## Create boolean variable for whether any contraceptive was used in the month of last intercourse.
fem1719dt <- fem1719METHX[
  century_month_comparison(`==`, LSEXDATE, CMMHCALX) &
    !is.na(METHX) &
    !is.element(METHX, c(1, 95, 98, 99)),
  .(
    used_in_month_last_sex = .N > 0
  ),
  by = CASEID
][fem1719dt]
fem1719dt[, used_in_month_last_sex := na_to_false(used_in_month_last_sex)]


## Create pivot table of MONSX variables for creating the sex12mo and sex_this_month variables below.
fem1719MONSX <- create_NSFG_pivot_table(
  'CMMONSX',
  2:48,
  c('CASEID', 'CMINTVW', 'CMLSTYR')
)[
  create_NSFG_pivot_table('MONSX', 2:48),
  on = c(CASEID = 'CASEID', CMMONSXID = 'MONSXID')
]


## Create sex12mo variable for females.
fem1719dt <- fem1719MONSX[
  !is.na(MONSX) & MONSX == 1 &
    CMMONSX > CMLSTYR &
    CMMONSX <= CMINTVW,
  .(sex12mo = TRUE),
  by = CASEID
][fem1719dt]
fem1719dt[, sex12mo := na_to_false(sex12mo)]


## Create sex_this_month variable.
fem1719dt <- fem1719MONSX[
  CMMONSX == CMINTVW,
  .(sex_this_month = equals(MONSX, 1)),
  by = CASEID
][fem1719dt]
fem1719dt[, sex_this_month := na_to_false(sex_this_month)]


## If last intercourse within the past 12 months was with husband or cohabitating partner who has an active vasectomy, then set boolean variable of vasectomy use in the past 12 months to true.
fem1719dt[,
  any_use_12m_method5 := fifelse(
    sex12mo & PSURGSTR == 'YES' & (
        P1YRELP == 'Current husband or (current husband from whom she is separated)' |
        P1YRELP == 'Current cohabiting partner'
      ),
    TRUE,
    any_use_12m_method5
  )
]


## If respondent has had intercourse in past 12 months and has an active tubal ligation (or essure), then set boolean variable of tubal ligation use at in the past 12 months to true.
fem1719dt[,
  any_use_12m_method6 := fifelse(
    sex12mo & TUBS == 'YES',
    TRUE,
    any_use_12m_method6
  )
]


## Reset count of methods used in the past 12 months to include overrides of vasectomy and tubal ligation boolean variables.
set_count_variable_for_mentions(fem1719dt, 'any_use_12m_method')


## Create categorical variable specifying consistency of any contraceptive method use over previous 12 months that combines P12MOCON and PXNOFREQ.
fem1719dt[,
  any_use_12m_consistency := factor(
    fcase(
      P12MOCON == 'Every time',
        'Every time',
      PXNOFREQ != 'No answer provided',
        as.character(PXNOFREQ),
      default = 'No answer provided'
    ),
    ordered = TRUE,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      "Don't know",
      'No answer provided'
    )
  )
]


## Create boolean variables for whether each method was used in the month preceding the interview.
set_NSFG_mentions_to_booleans(
  out_prefix = 'last_month_method',
  in_prefix = 'LSTMONMETH',
  in_series = 1:4,
  format = 'METHHXF',
  skip = c(1:2, 22:23, 55, 98:99)
)


## Create boolean variables for whether each method was used in the month of the interview.
set_NSFG_mentions_to_booleans(
  out_prefix = 'this_month_method',
  in_prefix = 'CURRMETH',
  in_series = 1:4,
  format = 'METHHXF',
  skip = c(1:2, 22:23, 55, 98:99)
)


## Create boolean variables for each reason for using pill.
set_NSFG_mentions_to_booleans(
  out_prefix = 'why_use_pill_reason',
  in_prefix = 'YUSEPILL',
  in_series = 1:6,
  format = 'YUSEMTHF'
)


## Create categorical variable reflecting overall motivation for pill use.
fem1719dt[,
  pill_motivation := factor(
    fcase(
      why_use_pill_reason1 & !(
        why_use_pill_reason2 |
        why_use_pill_reason3 |
        why_use_pill_reason4 |
        why_use_pill_reason5 |
        why_use_pill_reason6 |
        why_use_pill_reason7 |
        why_use_pill_reason8
      ), 'Only for birth control',
      !why_use_pill_reason1 & (
        why_use_pill_reason2 |
        why_use_pill_reason3 |
        why_use_pill_reason4 |
        why_use_pill_reason5 |
        why_use_pill_reason6 |
        why_use_pill_reason7 |
        why_use_pill_reason8
      ), 'Only for reasons other than contraception',
      default = 'For both reasons'
    )
  )
]


## Create boolean variables for each reason for using an IUD.
set_NSFG_mentions_to_booleans(
  out_prefix = 'why_use_iud_reason',
  in_prefix = 'YUSEIUD',
  in_series = 1:6,
  format = 'YUSEMTHF'
)


## Create categorical variable reflecting overall motivation for IUD use.
fem1719dt[,
  iud_motivation := factor(
    fcase(
      why_use_iud_reason99,
        "Don't know",
      why_use_iud_reason1 & (
        why_use_iud_reason2 |
        why_use_iud_reason3 |
        why_use_iud_reason4 |
        why_use_iud_reason5 |
        why_use_iud_reason6 |
        why_use_iud_reason7 |
        why_use_iud_reason8
      ),
        'For both reasons',
      why_use_iud_reason1 & !(
        why_use_iud_reason2 |
        why_use_iud_reason3 |
        why_use_iud_reason4 |
        why_use_iud_reason5 |
        why_use_iud_reason6 |
        why_use_iud_reason7 |
        why_use_iud_reason8
      ),
        'Only for contraception',
      !why_use_iud_reason1 & (
        why_use_iud_reason2 |
        why_use_iud_reason3 |
        why_use_iud_reason4 |
        why_use_iud_reason5 |
        why_use_iud_reason6 |
        why_use_iud_reason7 |
        why_use_iud_reason8
      ),
        'Only for reasons other than contraception',
      default = 'No answer provided'
    )
  )
]


## Create boolean variables for whether specific contraceptive method was ever used. Because this is encoded in various method-specific variables in addition to the OTHRMETH series, this has to be done in two parts. Additionally, IUD is being split into copper and hormone based IUDs, so this is handled as special cases.
fem1719dt[
  fem1719$Data,
  `:=`(
    ever_used_method3  = na_to_false(i.PILLR == 1),
    ever_used_method4  = na_to_false(i.CONDOMR == 1),
    ever_used_method5  = na_to_false(i.VASECTMY == 1),
    ever_used_method6  = na_to_false(i.EVERTUBS %in% c(1, 4) | i.ESSURE == 1),
    ever_used_method7  = na_to_false(i.WIDRAWAL == 1),
    ever_used_method8  = na_to_false(i.DEPOPROV == 1),
    ever_used_method10 = na_to_false(i.RHYTHM == 1),
    ever_used_method11 = na_to_false(i.TEMPSAFE == 1),
    ever_used_method20 = na_to_false(i.MORNPILL == 1),
    ever_used_method25 = na_to_false(i.PATCH == 1),
    ever_used_method26 = na_to_false(i.RING == 1),
    ever_used_method33 = na_to_false(
      has_level(i.EVIUDTYP1, c(3, 9)) |
      has_level(i.EVIUDTYP2, c(3, 9)) |
      has_level(i.EVIUDTYP3, c(3, 9))
    )
  )
]
for (x in c(1:2)) {
  fem1719dt[
    fem1719$Data,
    (sprintf('ever_used_method%d', 30 + x)) := na_to_false(
      has_level(i.EVIUDTYP1, x) |
      has_level(i.EVIUDTYP2, x) |
      has_level(i.EVIUDTYP3, x)
    )
  ]
}
set_NSFG_mentions_to_booleans(
  out_prefix = 'ever_used_method',
  in_prefix = 'OTHRMETH0',
  in_series = 1:7,
  format = 'OTHRMETHF',
  skip = c(19, 95)
)


## Create boolean variables for whether each contraceptive method was ever discontinued due to dissatisfaction. Because IUD types have been split out, these cases must be handled individually.
set_NSFG_mentions_to_booleans(
  out_prefix = 'ever_quit_method',
  in_prefix = 'METHSTOP',
  in_series = sprintf('%02d', 1:10),
  format = 'METHSTOPF'
)
for (x in c(1:2)) {
  fem1719dt[
    fem1719$Data,
    (sprintf('ever_quit_method%d', 30 + x)) := ever_quit_method19 & (
      has_level(i.TYPEIUD_1, x) |
      has_level(i.TYPEIUD_2, x) |
      has_level(i.TYPEIUD_3, x)
    )
  ]
}
fem1719dt[
  fem1719$Data,
  ever_quit_method33 := ever_quit_method19 & (
    has_level(i.TYPEIUD_1, c(3, 9)) |
    has_level(i.TYPEIUD_2, c(3, 9)) |
    has_level(i.TYPEIUD_3, c(3, 9))
  )
]


## Create boolean variables for reason(s) for dissatisfaction with condom.
set_NSFG_mentions_to_booleans(
  out_prefix = 'condom_quit_reason',
  in_prefix = 'REASCOND0',
  in_series = 1:7,
  format = 'REASMFMT'
)
set_NSFG_mentions_to_booleans(
  out_prefix = 'specific_condom_quit_reason',
  in_prefix = 'STOPCOND',
  in_series = 1:2,
  format = 'STOPCONDFMT'
)


## Create boolean variables for reason(s) for dissatisfaction with pill.
set_NSFG_mentions_to_booleans(
  out_prefix = 'pill_quit_reason',
  in_prefix = 'REASPILL0',
  in_series = 1:9,
  format = 'REASMFMT'
)
set_NSFG_mentions_to_booleans(
  out_prefix = 'specific_pill_quit_reason',
  in_prefix = 'STOPPILL',
  in_series = 1:6,
  format = 'STOPPILLFMT'
)


## Create boolean variables for reason(s) for dissatisfaction with IUDs.
set_NSFG_mentions_to_booleans(
  out_prefix = 'iud_quit_reason',
  in_prefix = 'REASIUD0',
  in_series = 1:5,
  format = 'REASMFMT'
)
set_NSFG_mentions_to_booleans(
  out_prefix = 'specific_iud_quit_reason',
  in_prefix = 'STOPIUD',
  in_series = 1:5,
  format = 'STOPIUDFMT'
)
```

```{r process-male-data, dependson='load-data'}

## Fix the labeling used by METH3MF for males to be more like that of females.
METH3MF1719_join_table <- as.data.table(matrix(
  data = c(
    1, 2,
    2, 5,
    4, 1,
    5, 4,
    6, 6,
    8, 7,
    9, 8,
    10, 23,
    11, 24,
    12, 17,
    13, 19
  ),
  ncol = 2,
  byrow = TRUE,
  dimnames = list(
    NULL,
    c('male_factor_value', 'fem_factor_value')
  )
))
METH3MF1719_replacements <- rbindlist(list(
  fem1719formats[
    format_name == 'METH3MF',
    .(
      fem_factor_value = factor_value,
      factor_label
    )
  ][
    METH3MF1719_join_table,
    .(
      factor_value = male_factor_value,
      factor_label = factor_label
    ),
    on = 'fem_factor_value'
  ],
  data.table(
    factor_value = c(
      3,
      7,
      95,
      96
    ),
    factor_label = c(
      'Vasectomy',
      'Spermicidal foam, jelly, cream, film, or suppository',
      "Don't know",
      'No method used at last sex in the past 3 months'
    )
  )
))
METH3MF1719_replacements[, format_name := 'METH3MF']
male1719formats <- copy(male1719$Formats)
male1719formats[
  METH3MF1719_replacements,
  factor_label := i.factor_label,
  on = c('format_name', 'factor_value')
]


## Start working male respondents data table.
male1719dt <- copy(male1719$Data[, .(
  AGE_R,
  CASEID,
  CMLSTYR,
  CMLSXCWP,
  CONDFREQ,
  CWPALLBC01,
  PXCONFRQ,
  PXMETHOD01,
  SECU,
  SEST,
  WGT2017_2019
)])


## Copy variables to working data table and set them to factors.
set_NSFG_variables_as_factors(
  sex = 'male',
  variables = c(
    ATTRACT = 'ATTRACT',
    CONDVAG = 'YESNONAF',
    CWPLMET201 = 'MTHDSV3F',
    CWPLUSE2 = 'Y1N5RDF',
    CWPNOFRQ = 'OFTIMEF',
    CWPPOSS = 'Y1N5RDF',
    CWPPRGNW ='Y1N5RDF',
    CWPTRYPG = 'Y1N5RDF',
    FATHPOSS = 'Y1N5RDF',
    HADSEX = 'HADSEX',
    P12MOCON = 'OFTIMEF',
    P12MOCONO = 'Y1N5RDF',
    P1COHABIT = 'Y1N5RDF',
    P1CURRWIFE = 'Y1N5RDF',
    PSURGSTR = 'N0Y1CF',
    PXCPREG = 'Y1N5RDF',
    PXLPMETH01 = 'MTHDSV3F',
    PXLPUSE = 'Y1N5RDF',
    PXLSXPRB = 'Y1N5RDF',
    PXNOFREQ = 'OFTIMEF',
    PXTRYING = 'Y1N5RDF',
    RSURGSTR = 'N0Y1RDF',
    SEX12MO = 'SEX3MO',
    SEX3MO = 'SEX3MO',
    VAGSEX = 'YESNONAF',
    WHYCONDL = 'WHYCONDF',
    YNOSEX = 'YNOSEX'
  )
)


## Create categorical variable for whether had intercourse with opposite sex in previous 3 months.
male1719dt[,
  sexually_active_3m := factor(fifelse(
    SEX3MO == 'YES, HAD INTERCOURSE',
    'Had intercourse',
    'Did not have intercourse'
  ))
]


## Create boolean variables for whether each contraceptive method was used during last intercourse within the past 3 months.
set_NSFG_mentions_to_booleans(
  sex = 'male',
  out_prefix = 'used_last_3m_method',
  in_prefix = 'METH3M',
  in_series = 1:4,
  format = 'METH3MF',
  skip = 95:96
)


## If last intercourse within the past 3 months was with wife or cohabitating partner who has an tubal ligation (or other sterilizing procedure), then set boolean variable of tubal ligation use during last intercourse within the past 3 months to true.
male1719dt[,
  used_last_3m_method5 := fifelse(
    SEX3MO == 'YES, HAD INTERCOURSE' &
      (P1CURRWIFE == 'Yes' | P1COHABIT == 'Yes') &
      PSURGSTR == 'YES',
    TRUE,
    used_last_3m_method5
  )
]


## If respondent has had intercourse in the past 3 months and has an active vasectomy, then set boolean variable of vasectomy use during last intercourse within the past 3 months to true.
male1719dt[,
  used_last_3m_method3 := fifelse(
    SEX3MO == 'YES, HAD INTERCOURSE' & RSURGSTR == 'YES',
    TRUE,
    used_last_3m_method3
  )
]


## Reset count of methods used during last intercourse within the past 3 months to include overrides of tubal ligation and vasectomy boolean variables.
set_count_variable_for_mentions(male1719dt, 'used_last_3m_method')


## Create categorical variable specifying reasons not at increased risk for unintended pregnancy, if applicable.
male1719dt[,
  used_last_3m_status := factor(
    fcase(
      used_last_3m_method_count > 0,
        'Used at least one contraceptive method during last intercourse',
      SEX3MO != 'YES, HAD INTERCOURSE',
        'Did not have sexual intercourse with female in past 3 months',
      PXCPREG == 'Yes' | ((P1CURRWIFE == 'Yes' | P1COHABIT == 'Yes') & CWPPRGNW == 'Yes'),
        'Last intercourse was with partner who is pregnant',
      PXTRYING == 'Yes' | ((P1CURRWIFE == 'Yes' | P1COHABIT == 'Yes') & CWPTRYPG == 'Yes'),
        'Last intercourse was with partner who is trying to conceive',
      FATHPOSS == 'No',
        'Physically infertile not due to sterilizing procedure',
      (P1CURRWIFE == 'Yes' | P1COHABIT == 'Yes') & CWPPOSS == 'No',
        'Last intercourse was with partner who is physically unable to concieve',
      default = 'Otherwise did not use contraception during last intercourse'
    ),
    ordered = TRUE,
    levels = c(
      'Used at least one contraceptive method during last intercourse',
      'Did not have sexual intercourse with female in past 3 months',
      'Last intercourse was with partner who is pregnant',
      'Last intercourse was with partner who is trying to conceive',
      'Physically infertile not due to sterilizing procedure',
      'Last intercourse was with partner who is physically unable to concieve',
      'Otherwise did not use contraception during last intercourse'
    )
  )
]


## Create boolean variables for whether each specific method was used in past 12 months.
for (x in get_NSFG_format_indices('MTHDSV1F', skip = c(10, 98:99), sex = 'male')) {
  male1719dt[,
    (sprintf('any_use_12m_method%d', x)) := male1719$Data[,
      !is.na(
        (century_month_comparison(`>`, CMLSXCWP, CMLSTYR) & (
          CWPLMET11 == x |
          CWPLMET12 == x |
          CWPLMET13 == x |
          CWPLMET201 == x |
          CWPLMET202 == x
        )) |
        (century_month_comparison(`>`, CMFSXCWP, CMLSTYR) & (
          CWPFMET01 == x |
          CWPFMET02 == x |
          CWPFMET03 == x |
          CWPFMET04 == x |
          CWPFMET05 == x
        )) |
        CWPALLBC01 == x |
        CWPALLBC02 == x |
        CWPALLBC03 == x |
        CWPALLBC04 == x |
        CWPALLBC05 == x |
        (century_month_comparison(`>`, CMLSXP1, CMLSTYR) & (
          PXLRMETH1 == x |
          PXLRMETH2 == x |
          PXLRMETH3 == x |
          PXLPMETH01 == x |
          PXLPMETH02 == x |
          PXLPMETH03 == x
        )) |
        (century_month_comparison(`>`, CMLSXP2, CMLSTYR) & (
          PXLRMETH5 == x |
          PXLRMETH6 == x |
          PXLRMETH7 == x |
          PXLPMETH11 == x |
          PXLPMETH12 == x |
          PXLPMETH13 == x
        )) |
        (century_month_comparison(`>`, CMLSXP3, CMLSTYR) & (
          PXLRMETH9 == x |
          PXLRMETH10 == x |
          PXLRMETH11 == x |
          PXLPMETH21 == x |
          PXLPMETH22 == x |
          PXLPMETH23 == x
        )) |
        (century_month_comparison(`>`, CMFSXP, CMLSTYR) & (
          PXFMETH01 == x |
          PXFMETH02 == x |
          PXFMETH03 == x |
          PXFMETH04 == x
        )) |
        (century_month_comparison(`>`, CMFSXP2, CMLSTYR) & (
          PXFMETH14 == x |
          PXFMETH15 == x |
          PXFMETH16 == x |
          PXFMETH17 == x
        )) |
        (century_month_comparison(`>`, CMFSXP3, CMLSTYR) & (
          PXFMETH27 == x |
          PXFMETH28 == x |
          PXFMETH29 == x |
          PXFMETH30 == x
        )) |
        PXMETHOD01 == x |
        PXMETHOD02 == x |
        PXMETHOD03 == x |
        PXMETHOD04 == x |
        PXMETHOD05 == x |
        PXMETHOD14 == x |
        PXMETHOD15 == x |
        PXMETHOD16 == x |
        PXMETHOD17 == x |
        PXMETHOD18 == x |
        PXMETHOD27 == x |
        PXMETHOD28 == x |
        PXMETHOD29 == x |
        PXMETHOD30 == x |
        PXMETHOD31 == x
      )
    ]
  ]
}

## Set a boolean variable for whether "Something else" was used in past 12 months separately because its encoding collides with "Contraceptive patch (Ortho-Evra)".
male1719dt[,
  any_use_12m_method13 := male1719$Data[,
    !is.na(
      (century_month_comparison(`>`, CMLSXCWP, CMLSTYR) & (
        CWPLMET11 == 10 |
        CWPLMET12 == 10 |
        CWPLMET13 == 10 |
        CWPLMET201 == 13 |
        CWPLMET202 == 13
      )) |
      (century_month_comparison(`>`, CMFSXCWP, CMLSTYR) & (
        CWPFMET01 == 13 |
        CWPFMET02 == 13 |
        CWPFMET03 == 13 |
        CWPFMET04 == 13 |
        CWPFMET05 == 13
      )) |
      CWPALLBC01 == 13 |
      CWPALLBC02 == 13 |
      CWPALLBC03 == 13 |
      CWPALLBC04 == 13 |
      CWPALLBC05 == 13 |
      (century_month_comparison(`>`, CMLSXP1, CMLSTYR) & (
        PXLRMETH1 == 10 |
        PXLRMETH2 == 10 |
        PXLRMETH3 == 10 |
        PXLPMETH01 == 13 |
        PXLPMETH02 == 13 |
        PXLPMETH03 == 13
      )) |
      (century_month_comparison(`>`, CMLSXP2, CMLSTYR) & (
        PXLRMETH5 == 10 |
        PXLRMETH6 == 10 |
        PXLRMETH7 == 10 |
        PXLPMETH11 == 13 |
        PXLPMETH12 == 13 |
        PXLPMETH13 == 13
      )) |
      (century_month_comparison(`>`, CMLSXP3, CMLSTYR) & (
        PXLRMETH9 == 10 |
        PXLRMETH10 == 10 |
        PXLRMETH11 == 10 |
        PXLPMETH21 == 13 |
        PXLPMETH22 == 13 |
        PXLPMETH23 == 13
      )) |
      (century_month_comparison(`>`, CMFSXP, CMLSTYR) & (
        PXFMETH01 == 13 |
        PXFMETH02 == 13 |
        PXFMETH03 == 13 |
        PXFMETH04 == 13
      )) |
      (century_month_comparison(`>`, CMFSXP2, CMLSTYR) & (
        PXFMETH14 == 13 |
        PXFMETH15 == 13 |
        PXFMETH16 == 13 |
        PXFMETH17 == 13
      )) |
      (century_month_comparison(`>`, CMFSXP3, CMLSTYR) & (
        PXFMETH27 == 13 |
        PXFMETH28 == 13 |
        PXFMETH29 == 13 |
        PXFMETH30 == 13
      )) |
      PXMETHOD01 == 13 |
      PXMETHOD02 == 13 |
      PXMETHOD03 == 13 |
      PXMETHOD04 == 13 |
      PXMETHOD05 == 13 |
      PXMETHOD14 == 13 |
      PXMETHOD15 == 13 |
      PXMETHOD16 == 13 |
      PXMETHOD17 == 13 |
      PXMETHOD18 == 13 |
      PXMETHOD27 == 13 |
      PXMETHOD28 == 13 |
      PXMETHOD29 == 13 |
      PXMETHOD30 == 13 |
      PXMETHOD31 == 13
    )
  ]
]


## Set a boolean variable for whether "Contraceptive patch (Ortho-Evra)" was used in past 12 months separately because its encoding collides with "Something else".
male1719dt[,
  any_use_12m_method10 := male1719$Data[,
    !is.na(
      (century_month_comparison(`>`, CMLSXCWP, CMLSTYR) & (
        CWPLMET201 == 10 |
        CWPLMET202 == 10
      )) |
      (century_month_comparison(`>`, CMFSXCWP, CMLSTYR) & (
        CWPFMET01 == 10 |
        CWPFMET02 == 10 |
        CWPFMET03 == 10 |
        CWPFMET04 == 10 |
        CWPFMET05 == 10
      )) |
      CWPALLBC01 == 10 |
      CWPALLBC02 == 10 |
      CWPALLBC03 == 10 |
      CWPALLBC04 == 10 |
      CWPALLBC05 == 10 |
      (century_month_comparison(`>`, CMLSXP1, CMLSTYR) & (
        PXLPMETH01 == 10 |
        PXLPMETH02 == 10 |
        PXLPMETH03 == 10
      )) |
      (century_month_comparison(`>`, CMLSXP2, CMLSTYR) & (
        PXLPMETH11 == 10 |
        PXLPMETH12 == 10 |
        PXLPMETH13 == 10
      )) |
      (century_month_comparison(`>`, CMLSXP3, CMLSTYR) & (
        PXLPMETH21 == 10 |
        PXLPMETH22 == 10 |
        PXLPMETH23 == 10
      )) |
      (century_month_comparison(`>`, CMFSXP, CMLSTYR) & (
        PXFMETH01 == 10 |
        PXFMETH02 == 10 |
        PXFMETH03 == 10 |
        PXFMETH04 == 10
      )) |
      (century_month_comparison(`>`, CMFSXP2, CMLSTYR) & (
        PXFMETH14 == 10 |
        PXFMETH15 == 10 |
        PXFMETH16 == 10 |
        PXFMETH17 == 10
      )) |
      (century_month_comparison(`>`, CMFSXP3, CMLSTYR) & (
        PXFMETH27 == 10 |
        PXFMETH28 == 10 |
        PXFMETH29 == 10 |
        PXFMETH30 == 10
      )) |
      PXMETHOD01 == 10 |
      PXMETHOD02 == 10 |
      PXMETHOD03 == 10 |
      PXMETHOD04 == 10 |
      PXMETHOD05 == 10 |
      PXMETHOD14 == 10 |
      PXMETHOD15 == 10 |
      PXMETHOD16 == 10 |
      PXMETHOD17 == 10 |
      PXMETHOD18 == 10 |
      PXMETHOD27 == 10 |
      PXMETHOD28 == 10 |
      PXMETHOD29 == 10 |
      PXMETHOD30 == 10 |
      PXMETHOD31 == 10
    )
  ]
]


## If respondent has had intercourse in the past 12 months and has an active vasectomy, then set boolean variable of vasectomy use at in the past 12 months to true.
male1719dt[,
  any_use_12m_method3 := fifelse(
    SEX12MO == 'YES, HAD INTERCOURSE' & RSURGSTR == 'YES',
    TRUE,
    any_use_12m_method3
  )
]


## If last intercourse with wife or cohabitating partner was within the past 12 months, and wife or cohabitating partner has an active tubal ligation (or other sterilizing procedure), then set boolean variable of tubal ligation use at in the past 12 months to true.
male1719dt[,
  any_use_12m_method5 := fifelse(
    SEX12MO == 'YES, HAD INTERCOURSE' &
      century_month_comparison(`>`, CMLSXCWP, CMLSTYR) &
      PSURGSTR == 'YES',
    TRUE,
    any_use_12m_method5
  )
]


## Count number of contraceptive methods used in past 12 months.
set_count_variable_for_mentions(male1719dt, 'any_use_12m_method')


## Create categorical variable specifying consistency of any contraceptive method use over previous 12 months with wife or cohabitating partner that combines CONDFREQ and CWPNOFRQ.
male1719dt[,
  any_use_12m_wcp_consistency := factor(
    fcase(
      CONDFREQ == 100,
        'Every time',
      CWPNOFRQ != 'No answer provided',
        as.character(CWPNOFRQ),
      default = 'No answer provided'
    ),
    ordered = TRUE,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      "Don't know",
      'No answer provided'
    )
  )
]


## Create categorical variable specifying consistency of any contraceptive method use over previous 12 months with last partner, who is not wife or cohabitating partner, that combines PXCONFRQ and PXNOFREQ.
male1719dt[,
  any_use_12m_p1_consistency := factor(
    fcase(
      PXCONFRQ == 100,
        'Every time',
      PXNOFREQ != 'No answer provided',
        as.character(PXNOFREQ),
      default = 'No answer provided'
    ),
    ordered = TRUE,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      "Don't know",
      'No answer provided'
    )
  )
]

## Create categorical variable specifying consistency of condom use over previous 12 months that combines P12MOCONO and P12MOCON.
male1719dt[,
  condom_12m_consistency := factor(
    fcase(
      P12MOCONO == 'Yes',
        'Every time',
      P12MOCONO == 'No',
        'None of the time',
      P12MOCON != 'No answer provided',
        as.character(P12MOCON),
      default = 'No answer provided'
    ),
    ordered = TRUE,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      "Don't know",
      'No answer provided'
    )
  )
]
```



# Introduction

The target population of the NSFG are persons aged 15-49 living in households in the United States. As a consequence of sampling design, the population does not include those without a current residential address nor does it include those living in group housing, such military bases, prisons, etc. However, the population does include college students living in dormitories by way of their parents' households.

In the NSFG, female respondents and male respondents are given different questionnaires, and NSFG results are provided in separate data tables for females and males. Therefore, separate estimates for females and males are given throughout this report.

Use of contraceptive methods for the purpose of contraception _per se_ is only relevant for sexual intercourse with the opposite sex, though, as seen in Section \@ref(use-of-contraceptive-methods-for-other-reasons), contraceptive methods are sometimes used for other purposes than contraception. Therefore, the NSFG and this report focus extensively on sexual intercourse between individuals of opposite sex. All mentions of sexual activity in this report should be interpreted to refer to sexual intercourse with the opposite sex unless stated otherwise.

## Disclosure Risk Reduction

## Use during last intercourse versus Use over Period of Time

The NSFG asks respondents about their use of contraception in two ways. In the first way, questions pertain to use of contraception during a specific sexual encounter. For instance, male respondents are asked what contraceptive method(s) were used during their first intercourse with their 3 most recent partners. In the second way, questions pertain to the use of contraception over some period of time. For instance, female respondents fill out a calendar indicating their use of contraception for the 3 years prior to their interview.

There are at least two advantages to analysis of the use of contraception during the most recent intercourse:

* There is some measurement error in the reporting of contraceptive use over specific time periods. As seen in Section \@ref(any-method-during-past-12-months), some respondents who report using a method of contraception during a specific time frame, when asked about how consistently they used a method of contraception during the same time frame, report a frequency of "never," and as seen in Section \@ref(reasons-for-nonuse-when-not-intending-to-conceive), some respondents who report not using a method of contraception during the month of the interview, when asked why not, volunteer that they are using a method of contraception during the month of the interview. Analysis of contraceptive use during last intercourse rather than over a time period is intended to minimize this kind of measurement error.
* More detailed information is available on contraceptive use over periods of time for female respondents than for male respondents in the NSFG. In particular, whereas female respondents are asked whether multiple contraceptive methods used in the same month were used simultaneously or alternatively when completing their contraceptive history calendars, no such information is available for male respondents. However, analysis of contraceptive use during last intercourse can report equivalent statistics for both females and males.

One major disadvantage of analysis of contraceptive use during last intercourse is that there is variation among respondents in how long it has been, at the time of the interview, since their last intercourse.

Therefore, Section \@ref(use-of-contraception-during-most-recent-intercourse), which contains the most extensive analysis in this report, focuses on contraceptive use during the last intercourse within the 3 months prior to the interview.

## Failure to Report Sterilizing Operations as Contraceptive Methods

Some NSFG respondents reported having an active sterilizing operation, such as a tubal ligation or vasectomy, or having last had intercourse with a spouse or cohabitating partner with an active sterilizing operation, but in response to other questions do not report using said sterilizing operation as a method of contraception.

This is may be due to confusion on the part of respondents with questions referring to a specific sexual encounter or to a specific period of time, since the sterilizing operations in question are likely performed well in advance of the specific encounter or time frame.

Therefore, all those who reported having an active sterilizing operation or having intercourse with a spouse or cohabitating partner with an active sterilizing operation are counted as using said sterilizing operation as a method of contraception for the appropriate encounters or time frames, even if the respondents did not themselves mention the sterilizing operation when asked about methods of contraception.

Thus, even if a respondent does not mention using a partner's vasectomy when asked what methods were used during the last intercourse, if the respondent reports her last intercourse was with her husband and reports her husband has an active vasectomy, then the respondent is counted as using a partner's vasectomy as a contraceptive method during last intercourse.

Similarly, even if a respondent did not mention using tubal ligation during any of the 12 months preceding the interview, if the respondent had sexual intercourse during the 12 months preceding the interview and has an active tubal ligation, then the respondent is counted as using tubal ligation as a contraceptive method during the 12 months preceding the interview.


# Results

Sections \@ref(use-of-contraception-during-most-recent-intercourse) and \@ref(use-of-contraceptive-methods-for-other-reasons) pertain to what contraceptive method(s) were used during the sexual intercourse that occurred most recently before the respondents' interviews. Sections \@ref(use-of-contraception-during-past-12-months) and \@ref(consistency-of-use-of-contraception) focus on contraceptive use over the 12 months preceding the interview. Section \@ref(reasons-for-not-currently-using-contraception) pertains to contraceptive use reported in the month of the interview. Sections \@ref(use-of-contraception-ever-during-lifetime) and \@ref(discontinuation-due-to-dissatisfaction) pertain to contraceptive use ever during the lifetime of respondents.

## Population Size

```{r population-size, dependson=c('process-fem-data', 'process-male-data'), cache=FALSE}
fem1719dt[, person := 1]
male1719dt[, person := 1]

this <- list()
this$ht <- estimate_and_combine_NSFG_totals_and_percentages(~person, digits = 1)
this$df <- as.data.frame(this$ht)
this$fem <- this$df[3, 3]
this$femCI <-  this$df[3, 4]
this$ht[, 1:4] |>
  set_caption('Number persons aged 15-49 living in households in the United States estimated by the NSFG.') |>
  set_position('wrapright')
```

Based on the NSFG, there is an estimated `r this$fem` females[^millions] and `r this$male` males living in households in the United States. (Table \@ref(tab:population-size))[^ci] According to census data, there are 73,874,470 females and 74,595,017 males living in the United States.[^census] [@us_census_bureau_table_2010] The 95\% confidence intervals of the NSFG-based estimates of population size include the census-based counts. Thus, the NSFG survey estimates of population size are consistent with known population sizes.[^consistent]

[^ci]: The phrase "95\% C.I." refers to a 95\% [confidence interval](/how-to-scrutinize-a-statistic.html#estimation-error-and-confidence-intervals).

[^millions]:The "M" in the figures refers to "millions," such that "15.2M persons" describes approximately fifteen million, two hundred thousand persons.

[^census]: As of the writing of this report, the full results of the 2020 U.S. Census have not been released. Therefore, the 2010 Census is used. Census counts from 2010 can be expected to be lesser than what would have been the census counts from the 2017-2019 time frame, if there was any population growth between 2010 and 2017.

[^consistent]: Furthermore, the point estimates of population size based on the NSFG are quite close to the census counts, though the census counts are more than a million persons greater for both females and males. Unlike the NSFG estimates, the U.S. Census does count those without a current residential address and those living in group housing, which might account for these differences.



## Use of Contraception during Most Recent Intercourse

```{r sexually-active, dependson=c('process-fem-data', 'process-male-data'), cache=FALSE}
this <- list()
this$ht <- estimate_and_combine_NSFG_totals_and_percentages(~sexually_active_3m, digits = 1)
this$df <- as.data.frame(this$ht)
this$ht |> set_caption('Persons who have had sexual intercourse with someone of the opposite sex in the past 3 months, among persons aged 15-49 living in households in the United States.')
this$fem <- this$df[4, 3]
this$male <- this$df[6, 3]
```

The estimates in this section pertain to a subdomain of persons in the United States who had intercourse with someone of the opposite sex in the past 3 months. There are approximately `r this$fem` females and `r this$male` males in this subdomain. (Table \@ref(tab:sexually-active))

```{r used-last-3m-at-all, dependson=c('process-fem-data', 'process-male-data')}
fem1719dt[,
  used_last_3m_at_all := factor(fifelse(
    used_last_3m_method_count > 0,
    'Used contraception',
    'Did not use contraception'
  ))
]

male1719dt[,
  used_last_3m_at_all := factor(fifelse(
    used_last_3m_method_count > 0,
    'Used contraception',
    'Did not use contraception'
  ))
]

style_and_combine_totals_and_percentages_vertically(
  'Females',
  estimate_totals_and_percentages(
    ~used_last_3m_at_all,
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      sexually_active_3m == 'Had intercourse'
    )
  ),
  'Males',
  estimate_totals_and_percentages(
    ~used_last_3m_at_all,
    subset(
      get_NSFG_survey_design_for_sex('male'),
      sexually_active_3m == 'Had intercourse'
    )
  )
) |>
  set_caption('Persons who used any method of contraception during their last sexual intercourse with the opposite sex, among those who have had intercourse in the past 3 months.')
```

Over three quarters of persons sexually active with the opposite sex used at least one method of contraception during their most recent intercourse, and a slightly greater proportion of females report using contraception than males. (Table \@ref(tab:used-last-3m-at-all))


### Reason for Nonuse

```{r reason-for-nonuse, dependson=c('process-fem-data', 'process-male-data')}
style_and_combine_totals_and_percentages_vertically(
  'Females',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_status),
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      used_last_3m_method_count == 0 &
        SEX3MO == 'YES'
    )
  ),
  'Males',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_status),
    subset(
      get_NSFG_survey_design_for_sex('male'),
      used_last_3m_method_count == 0 &
        SEX3MO == 'YES, HAD INTERCOURSE'
    )
  )
) |>
  set_caption('Persons categorized by reason for not using contraception, among persons who had sexual intercourse with someone of the opposite sex in the past 3 months.')
```

Some persons intentionally refrain from using contraception for various reasons. The most common reason for intentional nonuse of contraception is a desire to conceive a pregnancy, followed by the female partner being currently pregnant. (Table \@ref(tab:reason-for-nonuse))

The "Otherwise did not use contraception during last intercourse" category in Table \@ref(tab:reason-for-nonuse) estimates contain those who are at increased risk for unintended pregnancy due contraceptive nonuse.

"Postpartum" is categorized separately in Table \@ref(tab:reason-for-nonuse) for females, but not for males because this information is not available in the public use data files for males due to disclosure risk reduction. "Otherwise did not use contraception during last intercourse" for males therefore includes some persons who last had intercourse with a postpartum female. However, as can be gleaned from the estimates for females, this is a small number of persons.

The "Physically infertile not due to sterilizing procedure" category is explored in Section \@ref(reason-for-physical-infertility-not-due-to-sterilizing-procedure).


### Contraception Use Rate

```{r contraception-use-rate, dependson=c('process-fem-data', 'process-male-data')}
style_and_combine_totals_and_percentages_vertically(
  'Females',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_status),
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      used_last_3m_status %in% c(
        'Used at least one contraceptive method during last intercourse',
        'Otherwise did not use contraception during last intercourse'
      )
    )
  ),
  'Males',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_status),
    subset(
      get_NSFG_survey_design_for_sex('male'),
      used_last_3m_status %in% c(
        'Used at least one contraceptive method during last intercourse',
        'Otherwise did not use contraception during last intercourse'
      )
    )
  )
) |>
  set_caption('Contraceptive use among persons who had sexual intercourse with someone of the opposite sex in past 3 months and are not themselves nor had intercourse with a partner who is intending to become pregnant, pregnant, postpartum, or physically infertile.')
```

Combining the estimates from Table \@ref(tab:used-last-3m-at-all) and Table \@ref(tab:reason-for-nonuse), an overall contraceptive use rate can be be calculated with the number of persons using contraception in the numerator and the sum of the number persons using contraception and the number of persons at increased risk for unintended pregancy due to contraceptive nonuse in the denominator.

Generally, the contraceptive use rate is high, though this still leaves several million persons at increased risk for unintended pregnancy due to contraceptive nonuse. (Table \@ref(tab:contraception-use-rate))

#### Reported Ignorance of Contraceptive Use

The contraceptive use rate is greater for females than males. (Table \@ref(tab:contraception-use-rate)) However, one factor that might decrease the rate at which males report contraceptive use is that some males do not know that their partners are using contraception.

```{r not-aware, dependson='process-male-data'}
male1719dt[,
  not_aware := factor(fifelse(
    CWPLUSE2 == "Don't know" |
      CWPLMET201 == "Don't know" |
      PXLPUSE == "Don't know" |
      PXLPMETH01 == "Don't know" |
      PXLSXPRB == 'Yes' |
      PXLSXPRB == "Don't know",
    "Ignorant of partner's contraceptive use",
    "Does not report ignorance of partner's contraceptive use"
  ))
]

estimate_totals_and_percentages(
  ~not_aware,
  subset(
    get_NSFG_survey_design_for_sex('male'),
    SEX3MO == 'YES, HAD INTERCOURSE'
  )
) |>
  style_totals_and_percentages() |>
  set_caption("Males who report ignorance of partner's contraceptive use during their last intercourse, among males who have had sexual intercourse with a female in the past 3 months.")
```

A small proportion of sexually active males report not knowing if their partner used contraception during their last intercourse. However, the estimates of Table \@ref(tab:not-aware) are based on two types of questions:

1. questions about partners' use of contraception, or
2. questions specifically asking respondents whether their partners could have used contraception without their knowledge.

Respondents are counted in the "Ignorant of partner's contraceptive use" category for the estimates of Table \@ref(tab:not-aware) if they respond "Don't know" to the first type of question or if they respond "Yes" or "Don't know" to the second type of question. However, the second type of questions are only asked of respondents who are neither married nor cohabitating.

Therefore, these results should be interpreted with care. This is discussed further in Section \@ref(less-reported-contraceptive-use-among-males).


### Sexual Inactivity

```{r sexual-inactivity, dependson=c('process-fem-data', 'process-male-data')}
this <- list()
this$fem <- estimate_totals_and_percentages(
  ~factor(HADSEX),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    SEX3MO != 'YES'
  )
)
this$male <- estimate_totals_and_percentages(
  ~factor(HADSEX),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    SEX3MO != 'YES, HAD INTERCOURSE'
  )
)

for (dt in this) {
  dt[,
    description := fcase(
      description == 'YES, R EVER HAD INTERCOURSE',
      'Had intercourse',
      description == 'NO, R NEVER HAD INTERCOURSE',
      'Never have had intercourse'
    )
  ]
}

style_and_combine_totals_and_percentages_vertically(
  'Females', this$fem, 'Males', this$male
) |>
  set_caption('Persons who have ever had intercourse with someone of the opposite sex, among persons who have not had intercourse with someone of the opposite sex in the past 3 months.')
```

Among persons who have not had intercourse with someone of the opposite sex in the past 3 months, a sizable minority have never had intercourse with someone of the opposite sex. (Table \@ref(tab:sexual-inactivity))

```{r never-had-sex, dependson=c('fem-process-data', 'male-process-data'), fig.cap='Persons who have never had sexual intercoruse with the opposite sex by age group.', fig.height=4, fig.width=5}
rbindlist(list(
  fem1719dt[
    HADSEX == 'NO, R NEVER HAD INTERCOURSE',
    .(
      WGT2017_2019,
      age = cut(AGE_R, breaks = seq(15, 50, 5), right = FALSE),
      sex = 'female'
    )
  ],
  male1719dt[
    HADSEX == 'NO, R NEVER HAD INTERCOURSE',
    .(
      WGT2017_2019,
      age = cut(AGE_R, breaks = seq(15, 50, 5), right = FALSE),
      sex = 'male'
    )
  ]
)) |>
  ggplot(
    mapping = aes(
      y = ..count.. / 10e5,
      x = age,
      weight = WGT2017_2019
    )
  ) +
  geom_bar(stat = 'count') +
  scale_y_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1),
    expand = expansion(mult = c(0, 0.05)),
    minor_breaks = seq(0, 12, 1),
    breaks = seq(0, 12, 2)
  ) +
  scale_x_discrete() +
  labs(
    x = 'Age',
    y = 'Total Persons'
  ) +
  theme_bw() +
  theme(
    axis.ticks = element_blank(),
    panel.grid.major.x = element_blank()
  )
```

Most persons who have never had sexual intercourse with someone of the opposite sex are in younger age groups, and totals of persons who have never had sexual intercourse decrease with increasing age. (Figure \@ref(fig:never-had-sex))


#### Reason for Never Having Intercourse

```{r fem-reason-no-sex, dependson='process-fem-data', fig.height=4, fig.width=7, fig.cap='Females by reason for not having had sexual intercourse with the opposite sex, among those who have not. Dots represent point estimates and brackets represent 95% confidence intervals.'}
estimate_totals_and_percentages(
  ~factor(YNOSEX),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    HADSEX == 'NO, R NEVER HAD INTERCOURSE'
  )
) |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1)
  )
```

```{r male-reason-no-sex, dependson='process-male-data', fig.height=3, fig.width=7, fig.cap='Males by reason for not having had sexual intercourse with the opposite sex, among those who have not. Dots represent point estimates and brackets represent 95% confidence intervals.'}
estimate_totals_and_percentages(
  ~factor(YNOSEX),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    HADSEX == 'NO, R NEVER HAD INTERCOURSE'
  )
) |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1)
  )
```

Many persons who have not had intercourse with someone of the opposite sex report "Haven't found the right person yet" as a reason, though this appears to be more common for males than for females. "Against religion or morals" is another commonly cited reason. It is notable that "Other" is also a popular reason chosen reported for not having had sex. (Figures \@ref(fig:fem-reason-no-sex) and \@ref(fig:male-reason-no-sex)) This is indirectly explored in the subsequent Section \@ref(attraction-by-sex).


#### Attraction by Sex

```{r fem-sex-attraction, dependson='process-fem-data'}
this <- list()

this$totals <- estimate_totals_and_percentages(
  ~sexually_active_3m,
  get_NSFG_survey_design_for_sex('fem')
) |> style_totals_and_percentages()

this$total_row <- cbind(
  this$totals[4, ],
  this$totals[3, 2:5]
) |>
  set_contents(
    1, 1, 'Total'
  ) |>
  set_contents(
    1, c(4:5, 8:9), ''
  ) |>
  set_bottom_border(final(1), everywhere, 1) |>
  set_top_border(final(1), everywhere, 1) |>
  set_left_border(everywhere, c(2, 6), 1) |>
  set_left_padding(everywhere, c(2, 6), 4)

this$chisq <- svychisq(
  ~ ATTRACT + sexually_active_3m,
  get_NSFG_survey_design_for_sex('fem'),
  statistic = 'adjWald'
)

style_and_combine_totals_and_percentages_horizontally(
  'Had intercourse with male in past 3 months',
  estimate_totals_and_percentages(
    ~factor(ATTRACT),
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      SEX3MO == 'YES'
    )
  ),
  'Did not have intercourse with male in past 3 months',
  estimate_totals_and_percentages(
    ~factor(ATTRACT),
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      SEX3MO != 'YES'
    )
  )
) |>
  rbind(this$total_row) |>
  set_caption('Females by attraction to males versus females.')
```

Among females who have had sexual intercourse with a male in the past 3 months, approximately 0.5\% describe themselves as "Mostly attracted to females" and 0.2\% as "Only attracted to females." However, among those that have not had intercourse with a male in the past 3 months, 4.9\% describe themselves as "Mostly attracted to females" and 4.4\% as "Only attracted to females." An adjusted Wald-Koch chi-squared test of homogeneity of proportions is statistically significant ($p = `r signif(this$chisq$p.value, 2)`$). Therefore, the differences in proportions of persons categorized by attraction in Table \@ref(tab:fem-sex-attraction) are not attributable to sampling error.

```{r male-sex-attraction, dependson='process-male-data'}
this <- list()

this$totals <- estimate_totals_and_percentages(
  ~I(SEX3MO == 'YES, HAD INTERCOURSE'),
  get_NSFG_survey_design_for_sex('male')
) |> style_totals_and_percentages()

this$total_row <- cbind(
  this$totals[4, ],
  this$totals[3, 2:5]
) |>
  set_contents(
    1, 1, 'Total'
  ) |>
  set_contents(
    1, c(4:5, 8:9), ''
  ) |>
  set_bottom_border(final(1), everywhere, 1) |>
  set_top_border(final(1), everywhere, 1) |>
  set_left_border(everywhere, c(2, 6), 1) |>
  set_left_padding(everywhere, c(2, 6), 4)

this$chisq <- svychisq(
  ~ ATTRACT + sexually_active_3m,
  get_NSFG_survey_design_for_sex('male'),
  statistic = 'adjWald'
)

style_and_combine_totals_and_percentages_horizontally(
  'Had intercourse with female in past 3 months',
  estimate_totals_and_percentages(
    ~factor(ATTRACT),
    subset(
      get_NSFG_survey_design_for_sex('male'),
      SEX3MO == 'YES, HAD INTERCOURSE'
    )
  ),
  'Did not have intercourse with female in past 3 months',
  estimate_totals_and_percentages(
    ~ATTRACT,
    subset(
      get_NSFG_survey_design_for_sex('male'),
      SEX3MO != 'YES, HAD INTERCOURSE'
    )
  )[1:9, ]
) |>
  rbind(this$total_row) |>
  set_caption('Males by attraction to females versus males.')
```

Similarly, the proportion of males who are "Only attracted to females" is approximately 92.4\% among those who have had intercourse with a female in the past 3 months, but only 79.5\% among those who have not, and the proportion "Only attracted to males" is approximately 0.1\% among those who had intercourse with a female in the past 3 months, but is 6.4\% among those who have not. An adjusted Wald-Koch chi-squared test of homogeneity of proportions is again statistically significant ($p = `r signif(this$chisq$p.value, 2)`$), and the differences in proportions of persons categorized by attraction in Table \@ref(tab:male-sex-attraction) are not due to sampling error.

Thus, some persons who are not sexually active with the opposite sex are simply not attracted to opposite sex, such as the approximately 1.5M males only attracted to males in Table \@ref(tab:male-sex-attraction).


### Reason for Physical Infertility Not Due to Sterilizing Procedure

```{r fem-infertility, dependson='process-fem-data', fig.height=4, fig.cap="Females by reason reported for their inability to become pregant, among those who report being physically infertile not due to a sterilizing procedure."}
estimate_totals_and_percentages(
  ~factor(REASIMPR),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    POSIBLPG == 'No'
  )
) |> plot_totals_with_CIs()
```

```{r fem-partner-infertility, dependson='process-fem-data', fig.height=3.5, fig.cap="Females by reason reported for their partners' inability to father a child, among those who report having a partner who is physically infertile not due to a sterilizing procedure."}
estimate_totals_and_percentages(
  ~factor(REASIMPP),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    POSIBLMN == 'No'
  )
) |> plot_totals_with_CIs()
```

The reason for physical infertility not due to a sterilizing procedure is part of the questionnaire for female respondents of the NSFG, but not the questionnaire for male respondents. As Figures \@ref(fig:fem-infertility) and \@ref(fig:fem-partner-infertility) illustrate, because these conditions are relatively rare, the effective sample sizes of the relevant subdomains from a two-year sequence of the NSFG are small, and the sampling error is quite large relative to the estimates.


### Number of Methods

```{r number-of-methods, dependson=c('process-fem-data', 'process-male-data')}
style_and_combine_totals_and_percentages_vertically(
  'Females',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_method_count),
    subset(
      get_NSFG_survey_design_for_sex('fem'),
      used_last_3m_method_count > 0
    )
  ),
  'Males',
  estimate_totals_and_percentages(
    ~factor(used_last_3m_method_count),
    subset(
      get_NSFG_survey_design_for_sex('male'),
      used_last_3m_method_count > 0
    )
  )
) |>
  set_caption('Persons categorized by number of contraceptive methods used during last intercourse, among persons who used contraception during sexual intercourse with someone of the opposite sex in the past 3 months.')
```

While the vast majority of both females and males used only one method of contraception during their last intercourse, a substantial minority of persons used multiple methods. (Table \@ref(tab:number-of-methods))


### Method(s) Used

```{r fem-methods-used, dependson='process-fem-data', fig.cap='Females categorized by whether or not each contraceptive method was used during last intercourse with a male in the past 3 months, with persons using multiple methods counted multiple times.'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_method_count > 0
  ),
  prefix = 'used_last_3m_method',
  skip = 20:21,
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1),
    breaks = \(x) seq(0, ceiling(x[2]), 2),
    limits = c(-0.05, 14)
  )
```

```{r male-methods-used, dependson='process-male-data', fig.cap='Males categorized by whether or not each contraceptive method was used during last intercourse with a female in the past 3 months, with persons using multiple methods counted multiple times.', fig.height=6}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_method_count > 0
  ),
  prefix = 'used_last_3m_method',
  skip = 95:96,
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1),
    breaks = \(x) seq(0, ceiling(x[2]), 2),
    limits = c(-0.05, 14)
  )
```

Overall, there are similar distributions between females and males in reported contraceptive method use during last intercourse. (Figures \@ref(fig:fem-methods-used) and \@ref(fig:male-methods-used)) For instance, condoms and pills are the most commonly reported methods by males, and they are the second and third most common methods reported by females. Indeed, female sterilizing operations, condoms, and pills are in the top three most common methods reported both by females and males. However, the most salient difference between females and males is that approximately 10.5M females report a female sterilizing operation being used during their last intercourse, whereas only approximately 6.7M males report a female sterilizing operation being used.

Other differences include a greater number of males reporting use of condom, pill, contraceptive patch, and "other" methods than females, and a greater number of females reporting use of intrauterine device (IUD), calendar-based, and temperature or cervical mucus test methods. Possible reasons for these and other differences are discussed in Section \@ref(differences-in-methods-reported-used-between-females-and-males).

Estimates of the number of female and male persons using withdrawal, vasectomy, implant, injectable, and ring methods are similar between females and males. Methods such as suppository, female condom, diaphragm, film, foam, jelly, and cream are rarely reported used by either females or males. Withdrawal is the fourth most commonly reported method both by females and males.


### Method Used Exclusively

```{r fem-exclusive-method-used, dependson='process-fem-data', fig.cap='Females categorized by which contraceptive method was used during last intercourse with a male in the past 3 months, among those who used exactly one method during last intercourse.'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_method_count == 1
  ),
  prefix = 'used_last_3m_method',
  skip = 20:21,
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1),
    breaks = seq(0, 10, 2),
    limits = c(-0.1, 10)
  )
```

```{r male-exclusive-method-used, dependson='process-male-data', fig.cap='Males categorized by which contraceptive method was used during last intercourse with a female in the past 3 months, among those who used exactly one method during last intercourse.'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_method_count == 1
  ),
  prefix = 'used_last_3m_method',
  skip = 95:96,
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 1),
    breaks = seq(0, 10, 2),
    limits = c(-0.1, 10)
  )
```

Restricting analysis to persons who used only one method of contraception during their last intercourse,  (Figures \@ref(fig:fem-exclusive-method-used) and \@ref(fig:male-exclusive-method-used)) there is a similar overall pattern of contraceptive method use as seen in Section \@ref(methods-used). However, in this subdomain, the number of females and number of males reporting pill use is roughly the same. Another salient difference in this subdomain is that there are relatively fewer persons who report using withdrawal, indicating a substantial number of withdrawal users do not rely on withdrawal as a their primary method of contraception, investigated further in Section \@ref(proportion-of-method-users-who-also-used-other-methods).


### Proportion of Method Users Who Also Used Other Method(s)

```{r fem-proportion-another, dependson='process-fem-data', fig.cap='Proportion using another method of contraception among females using each method of contraception during last intercourse with a male in the past 3 months.'}
estimate_NSFG_mentions_in_subdomains(
  row_estimation_function = function(x) {
    estimate_row_total_and_percentage(
      ~I(used_last_3m_method_count > 1),
      subset(
        get_NSFG_survey_design_for_sex('fem'),
        fem1719dt[, get(sprintf('used_last_3m_method%d', x))]
      )
    )
  },
  format = 'METH3MF',
  skip = c(20:22)
)[!is.nan(percentage_CI_high)][order(-percentage)] |>
  plot_percentages_with_CIs()
```

```{r male-proportion-another, dependson='process-fem-data', fig.cap='Proportion using another method of contraception among males using each method of contraception during last intercourse with a female in the past 3 months.'}
estimate_NSFG_mentions_in_subdomains(
  sex = 'male',
  row_estimation_function = function(x) {
    estimate_row_total_and_percentage(
      ~I(used_last_3m_method_count > 1),
      subset(
        get_NSFG_survey_design_for_sex('male'),
        male1719dt[, get(sprintf('used_last_3m_method%d', x))]
      )
    )
  },
  format = 'METH3MF',
  skip = 95:96
)[!is.nan(percentage_CI_high)][order(-percentage)] |>
  plot_percentages_with_CIs()
```

A direct way to measure the extent to which specific contraceptive methods are used exclusively or in combination with other methods is to estimate the proportion of users of each method that used it with another method. (Figures \@ref(fig:fem-proportion-another) and \@ref(fig:male-proportion-another).) The number of persons using safe period by temperature or cervical mucus test method, contraceptive patch method, emergency contraception, and "other" method are relatively few, constituting small effective sample sizes with large sampling errors. Indeed, estimates for contraceptive patch are contradictory between female and male respondents.

Ignoring those, calendar-based methods have the greatest proportion of users who also used another method during their last intercourse, particularly among females. As alluded to in Section \@ref(method-used-exclusively), about half of withdrawal users used another method during their last intercourse. Thus, withdrawal use is split between those using withdrawal as a primary method of contraception and those using withdrawal in addition to another method.

While a simple majority of users of pill and condom methods used them exclusively during their last intercourse, a sizable minority of pill and condom users also used another method. At the other end of the scale, female sterilizing operation and IUD are the methods most often used exclusively.

The remaining subsections of Section \@ref(use-of-contraception-during-most-recent-intercourse) explore what other contraceptive methods are used in conjunction with the methods commonly used with others, i.e., calendar, withdrawal, condom, and pill methods.


### Other Method(s) Used with Calendar Method

```{r other-with-calendar, dependson=c('process-fem-data', 'process-male-data')}
style_and_combine_totals_and_percentages_vertically(
  'Females',
  estimate_NSFG_mentions(
    survey_design = subset(
      get_NSFG_survey_design_for_sex('fem'),
      used_last_3m_method8
    ),
    prefix = 'used_last_3m_method',
    skip = c(8, 20:21),
    format = 'METH3MF'
  )[total > 0][order(-total)],
  'Males',
  estimate_NSFG_mentions(
    sex = 'male',
    survey_design = subset(
      get_NSFG_survey_design_for_sex('male'),
      used_last_3m_method9
    ),
    prefix = 'used_last_3m_method',
    skip = c(9, 95:96),
    format = 'METH3MF'
  )[total > 0][order(-total)]
) |>
  set_caption('Persons by other contraceptive method(s) used during last intercourse, among persons who used a calendar-based method of contraception during sexual intercourse with someone of the opposite sex in the past 3 months.') |>
  set_width(0.75) |>
  set_col_width(2, 2)
```

When used in conjunction with other methods, calendar-based methods are most commonly used with withdrawal or to a lesser extent condom. (Table \@ref(tab:other-with-calendar))


### Other Method(s) Used with Withdrawal

```{r fem-other-with-withdrawal, dependson='process-fem-data', fig.cap='Females by other contraceptive method(s) used during last intercourse, among those who used withdrawal during last intercourse with a male in the past 3 months.'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_method5
  ),
  prefix = 'used_last_3m_method',
  skip = c(5, 20:21),
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 0.1),
    breaks = seq(0, 1.8, 0.2),
    limits = c(-0.1, 1.85),
    expand = c(0, 0)
  )
```

```{r male-other-with-withdrawal, dependson='process-fem-data', fig.cap='Males by other contraceptive method(s) used during last intercourse, among those who used withdrawal during last intercourse with a female in the past 3 months.'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_method2
  ),
  prefix = 'used_last_3m_method',
  skip = c(2, 95:96),
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 0.1),
    breaks = seq(0, 1.8, 0.2),
    limits = c(-0.1, 1.85),
    expand = c(0, 0)
  )
```

When used in conjunction with other methods, withdrawal is used with many other methods. (Figures \@ref(fig:fem-other-with-withdrawal) and \@ref(fig:male-other-with-withdrawal)) Pills and condoms are used in conjunction with withdrawal more than the other methods, but pills and condoms are more common methods generally. (Section \@ref(methods-used)) Calendar-based methods are unusually common among methods used in conjunction with withdrawal reported by females. (Figure \@ref(fig:fem-other-with-withdrawal))



### Other Method(s) Used with Condom

```{r fem-other-with-condom, dependson='process-fem-data', fig.cap='Females by other contraceptive method(s) used during last intercourse, among those who used condom during last intercourse with a male in the past 3 months.'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_method2
  ),
  prefix = 'used_last_3m_method',
  skip = c(2, 20:21),
  format = 'METH3MF'
)[total > 0][order(-total)] |># style_totals_and_percentages()
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 0.1),
    breaks = seq(0, 3.4, 0.2),
    limits = c(-0.1, 3.6),
    expand = c(0, 0)
  )
```

```{r male-other-with-condom, dependson='process-male-data', fig.cap='Males by other contraceptive method(s) used during last intercourse, among those who used condom during last intercourse with a female in the past 3 months.'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_method1
  ),
  prefix = 'used_last_3m_method',
  skip = c(1, 95:96),
  format = 'METH3MF'
)[total > 0][order(-total)] |>
  plot_totals_with_CIs() +
  scale_x_continuous(
    labels = scales::label_number(suffix = 'M', accuracy = 0.1),
    breaks = seq(0, 3.4, 0.2),
    limits = c(-0.1, 3.6),
    expand = c(0, 0)
  )
```

Those who use condoms in conjunction with another method do so with a variety of other methods, though pills and to a lesser extent withdrawal are used in conjunction with condoms more than other methods, especially among males. (Figures \@ref(fig:fem-other-with-condom) and \@ref(fig:male-other-with-condom))


### Other Method(s) Used with Pill

Domain: Persons who had intercourse with opposite sex during the 3 months prior to interview and used pill during last intercourse

Description: By method(s), with those using multiple methods counted multiple times

**Females**

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_method1
  ),
  prefix = 'used_last_3m_method',
  skip = c(1, 20:21),
  format = 'METH3MF'
)[total > 0][order(-total)] |> style_totals_and_percentages()
```

**Males**

```{r, dependson='process-male-data'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_method4
  ),
  prefix = 'used_last_3m_method',
  skip = c(4, 95:96),
  format = 'METH3MF'
)[total > 0][order(-total)] |> style_totals_and_percentages()
```


## Use of Contraception during Past 12 Months

### Domain Size

Description: Persons who have had intercourse with opposite in the past 12 months

**Females**

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(sex12mo),
  get_NSFG_survey_design_for_sex('fem')
) |> style_totals_and_percentages()
```

**Males**

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(SEX12MO == 'YES, HAD INTERCOURSE'),
  get_NSFG_survey_design_for_sex('male')
) |> style_totals_and_percentages()
```


### Number of Methods

Domain: Females who have had intercourse with a male in the past 12 months

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(any_use_12m_method_count),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    sex12mo
  )
) |> style_totals_and_percentages()
```

Domain: Males who have had intercourse with a female in the past 12 months

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(any_use_12m_method_count),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    SEX12MO == 'YES, HAD INTERCOURSE'
  )
) |> style_totals_and_percentages()
```


### Method(s) Used

Domain: Persons who had intercourse with opposite sex during the 12 months prior to interview and used a method of contraception at least once

Description: By method(s), with those using multiple methods counted multiple times

**Females**

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    any_use_12m_method_count > 0
  ),
  prefix = 'any_use_12m_method',
  skip = c(1:2, 22:23, 55, 98:99),
  format = 'METHHXF'
)[order(-total)] |> style_totals_and_percentages()
```

**Males**

```{r, dependson='process-male-data'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    any_use_12m_method_count > 0
  ),
  prefix = 'any_use_12m_method',
  skip = 98:99,
  format = 'MTHDSV1F'
)[order(-total)] |> style_totals_and_percentages()
```


### Method Used Exclusively in Past 12 Months

Domain: Persons who had intercourse with opposite sex during the 12 months prior to interview and reporting using only one method of contraception during the 12 months prior to interview

**Females**

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    any_use_12m_method_count == 1
  ),
  prefix = 'any_use_12m_method',
  skip = c(1:2, 22:23, 55, 98:99),
  format = 'METHHXF'
)[total > 0][order(-total)] |> style_totals_and_percentages()
```

**Males**

```{r, dependson='process-male-data'}
estimate_NSFG_mentions(
  sex = 'male',
  survey_design = subset(
    get_NSFG_survey_design_for_sex('male'),
    any_use_12m_method_count == 1
  ),
  prefix = 'any_use_12m_method',
  skip = 98:99,
  format = 'MTHDSV1F'
)[order(-total)] |> style_totals_and_percentages()
```


## Consistency of Use of Contraception

### Use of Contraception Prior to Nonuse during last intercourse

Domain: Females who have had intercourse with a male in the past 3 months and did not use a method of contraception during last intercourse

Description: By whether used a method of contraception in past 12 months

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(any_use_12m_method_count > 0),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_status == 'Otherwise did not use contraception during last intercourse'
  )
) |> style_totals_and_percentages()
```

Domain: Females who have had intercourse with a male in the past 3 months and did not use a method of contraception during last intercourse

Description: By whether reported using a method in the month of last intercourse

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(used_in_month_last_sex),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_status == 'Otherwise did not use contraception during last intercourse'
  )
) |> style_totals_and_percentages()
```

Domain: Females who have had intercourse with a male in the past 3 months and did not use a method of contraception during last intercourse

Description: By whether used a method of contraception ever

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(EVERUSED),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    used_last_3m_status == 'Otherwise did not use contraception during last intercourse'
  )
) |> style_totals_and_percentages()
```

Domain: Males who have had intercourse with a female in the past 3 months and did not use a method of contraception during last intercourse

Description: By whether used a method of contraception in past 12 months

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~I(any_use_12m_method_count > 0),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    used_last_3m_status == 'Otherwise did not use contraception during last intercourse'
  )
) |> style_totals_and_percentages()
```


### Any Method During Past 12 Months

Domain: Females who had intercourse with a male during the 12 months prior to interview, who used a method of contraception at least once, and who do not have active sterilizing operations such as tubal ligations

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(any_use_12m_consistency),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    sex12mo &
      any_use_12m_method_count > 0 &
      TUBS != 'YES'
  )
) |> style_totals_and_percentages()
```

Domain: Males who had used at least one method of contraception during intercourse with wife or cohabitating partner during the 12 months prior to interview, who do not have active sterilizing operations such as vasectomies, and whose partners do not have active sterilizing operations such as tubal ligations

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(any_use_12m_wcp_consistency),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    !is.na(CWPALLBC01) &
      RSURGSTR != 'YES' &
      PSURGSTR != 'YES'
  )
) |> style_totals_and_percentages()
```

Domain: Males who had used at least one method of contraception during intercourse with last partner, who is not wife or cohabitating partner, during the 12 months prior to interview, and who do not have active sterilizing operations such as vasectomies

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(any_use_12m_p1_consistency),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    !is.na(PXMETHOD01) &
      RSURGSTR != 'YES'
  )
) |> style_totals_and_percentages()
```


### Condom Use During Past 12 Months

Domain: Females who had intercourse with a male during the 12 months prior to interview, who used condom at least once in the past 12 months

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(
    P12MOCON,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      'No answer provided'
    )
  ),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    sex12mo &
      any_use_12m_method4
  )
) |> style_totals_and_percentages()
```

Domain: Males who had intercourse with a female during the 12 months prior to interview, who used condom at least once in the past 12 months

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(condom_12m_consistency),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    SEX12MO == 'YES, HAD INTERCOURSE' &
        any_use_12m_method1
  )
) |> style_totals_and_percentages()
```

Domain: Females who had intercourse with a male during the 12 months prior to interview and whose only method of contraception used in the past 12 months is condom

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(
    P12MOCON,
    levels = c(
      'Every time',
      'Most of the time',
      'About half of the time',
      'Some of the time',
      'None of the time',
      'Refused',
      'No answer provided'
    )
  ),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    sex12mo &
      any_use_12m_method4 &
      any_use_12m_method_count == 1
  )
) |> style_totals_and_percentages()
```

Domain: Males who had intercourse with a female during the 12 months prior to interview and whose only method of contraception used in the past 12 months is condom

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(condom_12m_consistency),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    SEX12MO == 'YES, HAD INTERCOURSE' &
      any_use_12m_method1 &
      any_use_12m_method_count == 1
  )
) |> style_totals_and_percentages()
```


### Pill Use During Past 4 Weeks

Domain: Females who used pill in the month of the interview or the previous month

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(MISSPILL),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    last_month_method3 | this_month_method3
  )
) |> style_totals_and_percentages()
```



## Use of Contraceptive Methods for Other Reasons

### Condom

Domain: Females who have had vaginal intercourse with a male

Description: By whether used condom during last intercourse with a male

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(CONDVAG),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    VAGSEX %in% c(
      'Yes',
      'No answer provided'
    )
  )
) |> style_totals_and_percentages()
```

Domain: Males who have had vaginal intercourse with a female

Description: By whether used condom during last intercourse with a female

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(CONDVAG),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    VAGSEX %in% c(
      'Yes',
      'No answer provided'
    )
  )
) |> style_totals_and_percentages()
```

Domain: Females who used condom during last intercourse with a male

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(WHYCONDL),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    CONDVAG == 'Yes'
  )
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Males who used condom during last intercourse with a female

```{r, dependson='process-male-data'}
estimate_totals_and_percentages(
  ~factor(WHYCONDL),
  subset(
    get_NSFG_survey_design_for_sex('male'),
    CONDVAG == 'Yes'
  )
)[order(-total)] |> style_totals_and_percentages()
```


### Pill

Description: By whether used pill either during the month of interview or the month preceding the interview

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(this_month_method3 | last_month_method3),
  get_NSFG_survey_design_for_sex('fem')
) |> style_totals_and_percentages()
```

Domain: Females who used pill either during the month of interview or the month preceding the interview

Description: By reason(s), with those mentioning multiple reasons counted multiple times

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    this_month_method3 | last_month_method3
  ),
  prefix = 'why_use_pill_reason',
  format = 'YUSEMTHF',
  skip = 98:99
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who used pill either during the month of interview or the month preceding the interview

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~pill_motivation,
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    this_month_method3 | last_month_method3
  )
)[order(-total)] |> style_totals_and_percentages()
```


### IUD

Description: By whether used an IUD either during the month of interview or the month preceding the interview*

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(this_month_method19 | last_month_method19),
  get_NSFG_survey_design_for_sex('fem')
) |> style_totals_and_percentages()
```

Domain: Females who used an IUD either during the month of interview or the month preceding the interview

Description: By reason(s), with those mentioning multiple reasons counted multiple times*

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    this_month_method19 | last_month_method19
  ),
  prefix = 'why_use_iud_reason',
  format = 'YUSEMTHF',
  skip = 98:99
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who used an IUD either during the month of interview or the month preceding the interview*

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(iud_motivation),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    this_month_method19 | last_month_method19
  )
)[order(-total)] |> style_totals_and_percentages()
```


## Reason(s) for Not Currently Using Contraception

### Domain Size

Description: Females who are not currently pregnant, had intercourse in the month of interview, are neither sterilized nor sterile, and did not use a contraceptive in month of interview*

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(
    CURRPREG == 'NO' &
      sex_this_month &
      !is.element(
        RSTRSTAT,
        c('SURGICALLY STERILE', 'NONSURGICALLY STERILE')
      ) &
      CURRMETH1 == 'No method used'
  ),
  get_NSFG_survey_design_for_sex('fem')
)[description == TRUE] |> style_totals_and_percentages()
```

### Intent to Conceive

Domain: Females who are not currently pregnant, had intercourse in the month of interview, are neither sterilized nor sterile, did not use a contraceptive in month of interview, and are not intending to conceive*

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(pregnancy_intent_status),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    CURRPREG == 'NO' &
      sex_this_month &
      !is.element(
        RSTRSTAT,
        c('SURGICALLY STERILE', 'NONSURGICALLY STERILE')
      ) &
      CURRMETH1 == 'No method used'
  )
) |> style_totals_and_percentages()
```

### Reason(s) for Nonuse When Not Intending to Conceive

Domain: Females who are not currently pregnant, had intercourse in the month of interview, are neither sterilized nor sterile, and did not use a contraceptive in month of interview

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    pregnancy_intent_status == 'Not intending to conceive'
  ),
  prefix = 'nonuse_reason',
  format = 'WHYNOUSNG'
)[order(-total)] |> style_totals_and_percentages()
```

### Reason(s) Respondent Believes She Cannot Become Pregnant

Domain: Females who are not currently pregnant, had intercourse in the month of interview, are neither sterilized nor sterile, and did not use a contraceptive in month of interview

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    nonuse_reason2
  ),
  prefix = 'pregnancy_impossible_reason',
  format = 'WHYNOTPGF'
)[order(-total)] |> style_totals_and_percentages()
```



## Use of Contraception Ever During Lifetime

Domain: Females aged 15-49 living in households in the United States

Description: By whether ever used any method of contraception

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(ever_used_method_count > 0),
  get_NSFG_survey_design_for_sex('fem')
)[order(-total)] |> style_totals_and_percentages()
```

Description: By whether ever used specific methods of contraception

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = get_NSFG_survey_design_for_sex('fem'),
  prefix = 'ever_used_method',
  format = 'ever_used_method'
)[order(-total)] |> style_totals_and_percentages()
```

### Among Those Who Have Ever Had Intercourse

Description: Females who have ever had intercourse with a male

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~factor(HADSEX),
  get_NSFG_survey_design_for_sex('fem')
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who have ever had intercourse with a male

Description: By whether ever used any method of contraception

```{r, dependson='process-fem-data'}
estimate_totals_and_percentages(
  ~I(ever_used_method_count > 0),
  subset(
    get_NSFG_survey_design_for_sex('fem'),
    HADSEX == 'YES, R EVER HAD INTERCOURSE'
  )
)[order(-total)] |> style_totals_and_percentages()
```

Description: By whether ever used specific methods of contraception

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    HADSEX == 'YES, R EVER HAD INTERCOURSE'
  ),
  prefix = 'ever_used_method',
  format = 'ever_used_method'
)[order(-total)] |> style_totals_and_percentages()
```



## Discontinuation Due to Dissatisfaction

Domain: For each method, females who have ever used the method

Description: For each method, females who have stopped using the method due to dissatisfaction

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions_in_subdomains(
  row_estimation_function = function(x) {
    estimate_row_total_and_percentage(
      as.formula(sprintf('~ever_quit_method%d', x)),
      subset(
        get_NSFG_survey_design_for_sex('fem'),
        fem1719dt[, get(sprintf('ever_used_method%d', x))]
      )
    )
  },
  format = 'ever_used_method',
  skip = c(20)
)[order(-total)] |> style_totals_and_percentages()
```


### Condom

Domain: Females who have ever discontinued using condom due to dissatisfaction

Description: Reason(s) for dissatisfaction selected from list provided in survey

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method4
  ),
  prefix = 'condom_quit_reason',
  format = 'REASMFMT'
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who have discontinued using condom because "too difficult to use," "side effects," or "other" reason

Description: Reason(s) for dissatisfaction volunteered by respondents

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    condom_quit_reason3 | condom_quit_reason6 | condom_quit_reason15
  ),
  prefix = 'specific_condom_quit_reason',
  format = 'STOPCONDFMT'
)[order(-total)] |> style_totals_and_percentages()
```


### Pill

Domain: Females who have ever discontinued using pill due to dissatisfaction

Description: Reason(s) for dissatisfaction selected from list provided in survey

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method3
  ),
  prefix = 'pill_quit_reason',
  format = 'REASMFMT'
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who have discontinued using pill because "too difficult to use," "side effects," or "other" reason

Description: Reason(s) for dissatisfaction volunteered by respondents

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    pill_quit_reason3 | pill_quit_reason6 | pill_quit_reason15
  ),
  prefix = 'specific_pill_quit_reason',
  format = 'STOPPILLFMT'
)[order(-total)] |> style_totals_and_percentages()
```


### Hormonal IUDs

Domain: Females who have ever discontinued using an hormonal IUD due to dissatisfaction

Description: Reason(s) for dissatisfaction selected from list provided in survey

```{r, dependson='process-pill-quit'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method32
  ),
  prefix = 'iud_quit_reason',
  format = 'REASMFMT'
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who have discontinued using an hormonal IUD because "too difficult to use," "side effects," or "other" reason

Description: Reason(s) for dissatisfaction volunteered by respondents

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method32 & (
      iud_quit_reason3 |
        iud_quit_reason6 |
        iud_quit_reason15
    )
  ),
  prefix = 'specific_iud_quit_reason',
  format = 'STOPIUDFMT'
)[order(-total)] |> style_totals_and_percentages()
```


### Copper IUDs

Domain: Females who have ever discontinued using a copper IUD due to dissatisfaction

Description: Reason(s) for dissatisfaction selected from list provided in survey

```{r, dependson='process-pill-quit'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method31
  ),
  prefix = 'iud_quit_reason',
  format = 'REASMFMT'
)[order(-total)] |> style_totals_and_percentages()
```

Domain: Females who have discontinued using copper IUD because "too difficult to use," "side effects," or "other" reason

Description: Reason(s) for dissatisfaction volunteered by respondents

```{r, dependson='process-fem-data'}
estimate_NSFG_mentions(
  survey_design = subset(
    get_NSFG_survey_design_for_sex('fem'),
    ever_quit_method31 & (
      iud_quit_reason3 |
        iud_quit_reason6 |
        iud_quit_reason15
    )
  ),
  prefix = 'specific_iud_quit_reason',
  format = 'STOPIUDFMT'
)[order(-total)] |> style_totals_and_percentages()
```



# Discussion

## Less Reported Contraceptive Use Among Males

## Differences in Methods Reported Used Between Females and Males



# Things to Do

* Write results and discussion section of report
* Add license to GitHub repository
* Compare own report with published reports
* Write introduction section of report
* Publish report on blog
